# FrameLeap 动态漫生成流程图

## 完整数据流程图

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              FrameLeap 动态漫生成系统                                      │
│                          AI-Driven Motion Comic Generation Pipeline                       │
└─────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 1: 输入处理 (Input Processing)                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入:                                                                                   │
│  • 用户文本 (一句话/短文/剧本/关键词)                                                    │
│  • 风格偏好 (艺术风格/渲染风格/时代风格)                                                   │
│  • 全局参数 (分辨率/帧率/时长)                                                           │
│  • 角色设定 (可选)                                                                       │
│  • 参考图片 (可选)                                                                       │
│                                                                                         │
│ 处理:                                                                                   │
│  • 文本清洗与标准化                                                                       │
│  • 输入验证与质量评分                                                                     │
│  • 关键信息提取 (主题/类型/角色/冲突/情感)                                                 │
│  • 自动补充缺失信息                                                                       │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ InputData            │                                                          │
│        │ - input_text          │                                                          │
│        │ - style               │                                                          │
│        │ - resolution          │                                                          │
│        │ - metadata            │                                                          │
│        └────────────────────────┘                                                          │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 2: 剧本生成 (Script Generation)                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐                                                            │
│       │ InputData            │                                                            │
│       │ (from 阶段1)          │                                                            │
│       └──────────────────────┘                                                            │
│                                                                                         │
│ 处理:                                                                                   │
│  • 故事分析 (主题/类型/结构识别)                                                          │
│  • 剧本结构规划 (三幕式/英雄之旅/短篇结构)                                                │
│  • 角色设定生成 (外貌/性格/表情库)                                                         │
│  • 场景拆分与描述                                                                        │
│  • 对白/旁白生成                                                                         │
│  • 分镜脚本生成 (景别/运镜/时长)                                                          │
│                                                                                         │
│ LLM调用: ┌──────────────────┐   ┌──────────────────┐   ┌──────────────────┐             │
│          │ GPT-4/ Claude     │   │ Qwen/ DeepSeek   │   │ Llama/ Local     │             │
│          │ / Gemini         │   │ / 千问           │   │ Models           │             │
│          └──────────────────┘   └──────────────────┘   └──────────────────┘             │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ Script               │                                                          │
│        │ - title               │ ───────────────────────┐                                 │
│        │ - story_type          │                        │                                 │
│        │ - theme               │                        ▼                                 │
│        │ - premise             │              ┌─────────────────────┐                   │
│        │ - scenes[]            │              │     Scene对象        │                   │
│        │   - order              │              ├─────────────────────┤                   │
│        │   - title              │              │ - order (序号)      │                   │
│        │   - description        │              │ - title (场景标题)  │                   │
│        │   - atmosphere         │              │ - description (描述)│                   │
│        │   - dialog             │              │ - atmosphere (氛围) │                   │
│        │ - characters{}         │              │ - characters (角色) │                   │
│        │   - [id] → Character    │              │ - dialog (对话)     │                   │
│        │ - rhythm_curve         │              └─────────────────────┘                   │
│        └───────────────────────┘                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                     ┌──────────────────┼──────────────────┐
                     │                  │                  │
                     ▼                  ▼                  ▼
        ┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
        │   Scene对象集合      │ │   Character集合     │ │   剧本元数据        │
        │   (场景描述)         │ │   (角色设定)       │ │   (结构信息)       │
        └─────────────────────┘ └─────────────────────┘ └─────────────────────┘
                     │                  │
                     └──────────────────┴──────────────────┐
                                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 3: 画面描述生成 (Scene Description & Prompt Engineering)                            │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐  ┌──────────────────────┐                                     │
│       │ Script               │  │ StyleConfig         │                                     │
│       │ (from 阶段2)          │  │ (from 阶段1)         │                                     │
│       │ - scenes[]            │  │ - art_style         │                                     │
│       │ - characters{}        │  │ - color_tone        │                                     │
│       └──────────────────────┘  └──────────────────────┘                                     │
│                                                                                         │
│ 处理:                                                                                   │
│  • 场景环境描述 (时间/天气/光照/氛围)                                                    │
│  • 构图描述 (布局/视角/焦点/留白)                                                        │
│  • 景别叙事应用 (远景/中景/近景/特写)                                                    │
│  • 色彩心理学应用 (冷暖色调/对比度)                                                      │
│  • 光影叙事功能 (顺光/侧光/逆光/轮廓光)                                                  │
│  • 提示词工程 (主体/环境/风格/质量/负面)                                                │
│                                                                                         │
│ LLM调用: ┌──────────────────┐   ┌──────────────────┐   ┌──────────────────┐                │
│          │ GPT-4            │   │ Qwen/ DeepSeek   │   │ Prompt 优化模型   │                │
│          │ (Prompt生成)     │   │ (中文优化)       │   │ (质量检查)       │                │
│          └──────────────────┘   └──────────────────┘   └──────────────────┘                │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ ScenePrompts[]       │ ───────────────────────┐                                 │
│        │ - scene_id           │                        │                                 │
│        │ - prompt             │                        ▼                                 │
│        │ - negative_prompt    │              ┌─────────────────────┐                   │
│        │ - composition        │              │    Prompt对象        │                   │
│        │ - lighting           │              ├─────────────────────┤                   │
│        │ - camera_angle       │              │ - positive (正向)   │                   │
│        │ - shot_size          │              │ - negative (负面)   │                   │
│        │ - style_tags         │              │ - composition      │                   │
│        │ - quality_tags       │              │ - lighting          │                   │
│        └──────────────────────┘              │ - camera           │                   │
│                                         └─────────────────────┘                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 4: 图像生成 (Image Generation)                                                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐         │
│       │ ScenePrompts[]       │  │ Character{}          │  │ StyleConfig         │         │
│       │ (from 阶段3)         │  │ (from 阶段2)         │  │ (from 阶段1)         │         │
│       └──────────────────────┘  └──────────────────────┘  └──────────────────────┘         │
│                                                                                         │
│ 处理:                                                                                   │
│  • 文生图生成 (SD/Flux/MJ/DALL-E)                                                        │
│  • 角色一致性控制 (LoRA/IP-Adapter/Reference)                                           │
│  • 多视角生成 (正面/侧面/背面/动态)                                                       │
│  • 图像后处理 (超分/降噪/锐化/调色)                                                      │
│  • 对话气泡区域预留                                                                     │
│                                                                                         │
│ 模型调用: ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐              │
│           │ Stable Diffusion│  │ Flux API         │  │ Midjourney API   │              │
│           │ SDXL / SD3      │  │ (快速生成)       │  │ (高质量)         │              │
│           └──────────────────┘  └──────────────────┘  └──────────────────┘              │
│           ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐              │
│           │ ControlNet      │  │ IP-Adapter       │  │ LoRA             │              │
│           │ (姿态/深度控制) │  │ (角色保持)       │  │ (风格/角色)      │              │
│           └──────────────────┘  └──────────────────┘  └──────────────────┘              │
│           ┌──────────────────┐  ┌──────────────────┐                                      │
│           │ Real-ESRGAN     │  │ SwinIR           │                                      │
│           │ (超分辨率)       │  │ (高质量增强)      │                                      │
│           └──────────────────┘  └──────────────────┘                                      │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ SceneImages[]        │ ───────────────────────┐                                 │
│        │ - scene_id           │                        │                                 │
│        │ - image_path         │                        ▼                                 │
│        │ - seed               │              ┌─────────────────────┐                   │
│        │ - metadata           │              │    Image文件         │                   │
│        │ - quality_score      │              │ - PNG/JPG格式       │                   │
│        │ - character_ref[]    │              │ - 高分辨率          │                   │
│        └──────────────────────┘              │ - 风格统一           │                   │
│                                         └─────────────────────┘                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 5: 分镜编排 (Storyboard & Shot Planning)                                            │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐         │
│       │ Script               │  │ SceneImages[]        │  │ VideoConfig         │         │
│       │ (from 阶段2)         │  │ (from 阶段4)         │  │ (from 阶段1)         │         │
│       │ - scenes[]            │  │                     │  │ - fps               │         │
│       │ - rhythm_curve       │  │                     │  │ - duration          │         │
│       └──────────────────────┘  └──────────────────────┘  └──────────────────────┘         │
│                                                                                         │
│ 处理:                                                                                   │
│  • 镜头时长计算 (对白/动作/情感/环境)                                                     │
│  • 镜头类型分配 (建立/对话/情绪/动作)                                                      │
│  • 镜头序列规划 (顺序优化/连贯性检查)                                                       │
│  • 节奏曲线设计 (快/慢/递进/交错)                                                           │
│  • 转场设计 (切换/淡入淡出/擦除/溶解)                                                       │
│  • 180度轴线规则确保                                                                     │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ Timeline             │ ───────────────────────┐                                 │
│        │ - shots[]            │                        │                                 │
│        │   - shot_id          │                        ▼                                 │
│        │   - scene_id         │              ┌─────────────────────┐                   │
│        │   - start_time       │              │    Shot对象          │                   │
│        │   - duration         │              ├─────────────────────┤                   │
│        │   - shot_size        │              │ - shot_id           │                   │
│        │   - camera_movement  │              │ - image_id          │                   │
│        │   - transition       │              │ - duration          │                   │
│        │ - audio_sync        │              │ - shot_size         │                   │
│        │ - total_duration     │              │ - camera_movement   │                   │
│        └──────────────────────┘              │ - transition        │                   │
│                                         └─────────────────────┘                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 6: 动画化 (Animation)                                                                │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐  ┌──────────────────────┐                                     │
│       │ Timeline             │  │ SceneImages[]        │                                     │
│       │ (from 阶段5)         │  │ (from 阶段4)         │                                     │
│       │ - shots[]            │  │                     │                                     │
│       └──────────────────────┘  └──────────────────────┘                                     │
│                                                                                         │
│ 处理:                                                                                   │
│  • 运镜生成 (平移/缩放/旋转/复合)                                                        │
│  • 角色动画 (呼吸/摆动/眨动)                                                              │
│  • AI图像动画化 (AnimateDiff/LivePortrait)                                                │
│  • 环境动画 (云层/水面/天气)                                                              │
│  • 特效动画 (速度线/冲击波/拟声词)                                                        │
│  • 帧插值 (RIFE/DAIN/FILM)                                                                │
│                                                                                         │
│ 模型/工具: ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐             │
│           │ AnimateDiff      │  │ LivePortrait     │  │ FFmpeg           │             │
│           │ (图像动画化)      │  │ (表情迁移)       │  │ (视频处理)       │             │
│           └──────────────────┘  └──────────────────┘  └──────────────────┘             │
│           ┌──────────────────┐  ┌──────────────────┐                                      │
│           │ RIFE/DAIN        │  │ 粒子系统          │                                      │
│           │ (帧插值)         │  │ (天气特效)       │                                      │
│           └──────────────────┘  └──────────────────┘                                      │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ AnimatedFrames[]     │ ───────────────────────┐                                 │
│        │ - shot_id            │                        │                                 │
│        │ - frame_paths[]      │                        ▼                                 │
│        │ - fps                │              ┌─────────────────────┐                   │
│        │ - frame_count        │              │    帧序列文件         │                   │
│        │ - animation_type     │              ├─────────────────────┤                   │
│        └──────────────────────┘              │ - PNG序列           │                   │
│                                         │ - 视频片段 (MP4)     │                   │
│                                         │ - 运镜数据          │                   │
│                                         └─────────────────────┘                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 7: 音频生成 (Audio Generation)                                                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐  ┌──────────────────────┐                                     │
│       │ Script               │  │ Timeline             │                                     │
│       │ (from 阶段2)         │  │ (from 阶段5)         │                                     │
│       │ - scenes[].dialog     │  │ - shots[].duration   │                                     │
│       │ - characters{}        │  │                     │                                     │
│       └──────────────────────┘  └──────────────────────┘                                     │
│                                                                                         │
│ 处理:                                                                                   │
│  • 配音生成 (TTS: 角色/情感/语速)                                                       │
│  • 音效生成 (环境/动作/AI音效)                                                           │
│  • BGM生成/选择 (情感/节奏匹配)                                                          │
│  • 音轨混音 (对白/音效/BGM平衡)                                                          │
│  • 音画同步 (时间戳对齐/口型同步)                                                         │
│  • 声音空间感设计 (景别对应混响)                                                         │
│                                                                                         │
│ 服务/工具: ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐             │
│           │ Azure TTS        │  │ Fish Audio       │  │ GPT-SoVITS       │             │
│           │ (高质量)         │  │ (中文)           │  │ (音色克隆)       │             │
│           └──────────────────┘  └──────────────────┘  └──────────────────┘             │
│           ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐             │
│           │ AudioLDM         │  │ Suno/Udio        │  │ FFmpeg           │             │
│           │ (音效生成)       │  │ (音乐生成)       │  │ (音频混音)       │             │
│           └──────────────────┘  └──────────────────┘  └──────────────────┘             │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ AudioTracks          │ ───────────────────────┐                                 │
│        │ - dialogue_track     │                        │                                 │
│        │ - sfx_track          │                        ▼                                 │
│        │ - bgm_track          │              ┌─────────────────────┐                   │
│        │ - mixed_audio        │              │    音频文件          │                   │
│        │ - sync_map           │              ├─────────────────────┤                   │
│        └──────────────────────┘              │ - WAV/MP3格式       │                   │
│                                         │ - 多轨分离          │                   │
│                                         │ - 混音后音频        │                   │
│                                         └─────────────────────┘                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                    ┌──────────────────┴──────────────────┐
                    │                  │                  │
                    ▼                  ▼                  ▼
        ┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
        │   AnimatedFrames[]   │ │   AudioTracks        │ │   Script元数据      │
        │   (动画帧序列)       │ │   (音频轨道)        │ │   (时间轴信息)      │
        └─────────────────────┘ └─────────────────────┘ └─────────────────────┘
                    │                  │                  │
                    └──────────────────┴──────────────────┴──────────────────┐
                                                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 8: 文字与字幕 (Text & Subtitle)                                                       │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐  ┌──────────────────────┐                                     │
│       │ Script               │  │ Timeline             │                                     │
│       │ (from 阶段2)         │  │ (from 阶段5)         │                                     │
│       │ - scenes[].dialog     │  │ - shots[].duration   │                                     │
│       └──────────────────────┘  └──────────────────────┘                                     │
│                                                                                         │
│ 处理:                                                                                   │
│  • 对话气泡生成 (形状/尾巴/样式)                                                        │
│  • 气泡自动排版 (位置算法/碰撞检测)                                                       │
│  • 字幕时间轴生成 (时间戳对齐)                                                           │
│  • 字幕样式设计 (字体/颜色/描边)                                                         │
│  • 拟声词特效 (速度线/冲击波文字)                                                        │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ TextElements          │ ───────────────────────┐                                 │
│        │ - bubbles[]          │                        │                                 │
│        │   - position         │                        ▼                                 │
│        │   - text             │              ┌─────────────────────┐                   │
│        │   - style            │              │    文字图层          │                   │
│        │ - subtitles[]        │              ├─────────────────────┤                   │
│        │   - time_range       │              │ - PNG带透明通道     │                   │
│        │   - text             │              │ - SRT字幕文件       │                   │
│        │   - position         │              │ - ASS字幕文件       │                   │
│        │ - srt_file          │              └─────────────────────┘                   │
│        │ - ass_file          │                                                                   │
│        └──────────────────────┘                                                                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                    ┌──────────────────┴──────────────────┐
                    │                  │                  │
                    ▼                  ▼                  ▼
        ┌─────────────────────┐ ┌─────────────────────┐ ┌─────────────────────┐
        │   AnimatedFrames[]   │ │   AudioTracks        │ │   TextElements      │
        │   (动画帧序列)       │ │   (音频轨道)        │ │   (文字图层)        │
        │   + 文字图层合成      │ │                     │ │                     │
        └─────────────────────┘ └─────────────────────┘ └─────────────────────┘
                    │                  │                  │
                    └──────────────────┴──────────────────┴──────────────────┐
                                                                               ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 9: 合成渲染 (Composition & Rendering)                                                 │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐         │
│       │ AnimatedFrames[]    │  │ AudioTracks          │  │ TextElements         │         │
│       │ (from 阶段6)         │  │ (from 阶段7)         │  │ (from 阶段8)         │         │
│       │                     │  │                     │  │                     │         │
│       │ Timeline            │  │                     │  │                     │         │
│       │ (from 阶段5)         │  │                     │  │                     │         │
│       └──────────────────────┘  └──────────────────────┘  └──────────────────────┘         │
│                                                                                         │
│ 处理:                                                                                   │
│  • 多轨道合成 (视频/音频/文字轨道)                                                      │
│  • 转场渲染 (淡入淡出/擦除/缩放)                                                         │
│  • 音视频同步 (时间戳对齐/帧精确同步)                                                     │
│  • 视频编码 (H.264/H.265/VP9)                                                           │
│  • 音频编码 (AAC/Opus)                                                                 │
│  • 容器封装 (MP4/WEBM/MOV)                                                             │
│  • 质量控制 (比特率/色彩空间/关键帧)                                                    │
│                                                                                         │
│ 工具: ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐                      │
│        │ FFmpeg           │  │ MoviePy          │  │ OpenCV           │                      │
│        │ (主要渲染引擎)   │  │ (Python接口)     │  │ (视频处理)       │                      │
│        └──────────────────┘  └──────────────────┘  └──────────────────┘                      │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ RenderedVideo        │ ───────────────────────┐                                 │
│        │ - video_path         │                        │                                 │
│        │ - format            │                        ▼                                 │
│        │ - resolution         │              ┌─────────────────────┐                   │
│        │ - duration          │              │    视频文件          │                   │
│        │ - fps               │              ├─────────────────────┤                   │
│        │ - codec             │              │ - MP4 (主要)        │                   │
│        │ - bitrate           │              │ - WEBM (可选)      │                   │
│        │ - metadata           │              │ - MOV (可选)       │                   │
│        └──────────────────────┘              └─────────────────────┘                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│ 阶段 10: 输出交付 (Output & Delivery)                                                     │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│ 输入: ┌──────────────────────┐                                                            │
│       │ RenderedVideo        │                                                            │
│       │ (from 阶段9)         │                                                            │
│       └──────────────────────┘                                                            │
│                                                                                         │
│ 处理:                                                                                   │
│  • 文件格式化 (完整/分章节/多分辨率)                                                       │
│  • 元数据添加 (标题/章节/封面缩略图)                                                     │
│  • 预览生成 (时间轴预览/缩略图)                                                         │
│  • 质量报告 (生成统计/质量评分)                                                           │
│  • 平台适配 (不同平台参数)                                                               │
│  • 批量处理 (队列管理/批量导出)                                                         │
│                                                                                         │
│ 输出: ───────────────────────┐                                                          │
│        │ FinalOutput           │ ───────────────────────┐                                 │
│        │ - video_file         │                        │                                 │
│        │ - metadata           │                        ▼                                 │
│        │ - thumbnails         │              ┌─────────────────────┐                   │
│        │ - quality_report     │              │    交付文件          │                   │
│        │ - versions[]         │              ├─────────────────────┤                   │
│        └──────────────────────┘              │ - MP4视频文件       │                   │
│                                         │ - 元数据文件        │                   │
│                                         │ - 缩略图            │                   │
│                                         │ - 质量报告          │                   │
│                                         └─────────────────────┘                   │
└─────────────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
                            ┌───────────────────────┐
                            │   最终视频输出         │
                            │   (MP4/WEBM/MOV)      │
                            │   下载/分享/预览       │
                            └───────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              数据依赖关系图                                                 │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  阶段1 (输入)                                                                           │
│       │                                                                                 │
│       ├──────> 阶段2 (剧本) ─────┐                                                       │
│       │                        │                                                       │
│       │                        ├──────> 阶段3 (画面描述) ─────┐                            │
│       │                        │                            │                            │
│       │                        │                            ├──────> 阶段4 (图像) ──┐    │
│       │                        │                            │                   │    │
│       ├───────────────────────┴────────────────────────────┴───────────────────┤    │
│       │                        │                            │                   │    │
│       │                        ▼                            ▼                   │    │
│       │                  阶段5 (分镜编排) <───────────────────────────────────┘    │
│       │                        │                                                        │
│       │                        ├──────> 阶段6 (动画)                                      │
│       │                        │                                                        │
│       │                        ├──────> 阶段7 (音频)                                      │
│       │                        │                                                        │
│       │                        ├──────> 阶段8 (字幕)                                      │
│       │                        │                                                        │
│       └───────────────────────┴──────> 阶段9 (合成) ─────> 阶段10 (输出)          │
│                                                                                         │
│  重新生成依赖:                                                                           │
│  • 阶段2 (剧本) 可独立重新生成 → 需要重新执行 阶段3,4                                    │
│  • 阶段4 (图像) 可独立重新生成 → 直接替换                                               │
│  • 阶段5 (分镜) 修改后 → 需要重新执行 阶段6,7,8,9                                          │
│  • 阶段7 (音频) 可独立重新生成 → 直接替换                                               │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              当前实现状态                                                   │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ✅ 已实现阶段:                                                                           │
│     • 阶段1: 输入处理 (Input)                                                              │
│     • 阶段2: 剧本生成 (Script) - 使用千问LLM                                               │
│     • 阶段3: 场景描述 (Scene Description)                                                  │
│     • 阶段4: 图像生成 (Image) - 使用通义万相                                               │
│                                                                                         │
│  🚧 待实现阶段:                                                                           │
│     • 阶段5: 分镜编排 (Storyboard)                                                         │
│     • 阶段6: 动画化 (Animation)                                                           │
│     • 阶段7: 音频生成 (Audio)                                                             │
│     • 阶段8: 文字字幕 (Text & Subtitle)                                                   │
│     • 阶段9: 合成渲染 (Composition)                                                       │
│     • 阶段10: 输出交付 (Output)                                                           │
│                                                                                         │
│  📊 当前后端实现:                                                                        │
│     • Web界面展示4阶段流程                                                               │
│     • 支持逐阶段重新生成                                                                   │
│     • WebSocket实时进度推送                                                               │
│     • 瀑布流式布局展示                                                                   │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘


## 技术栈总览

| 阶段 | 主要技术 | 云端API | 本地模型 | 说明 |
|-----|---------|---------|---------|------|
| 1. 输入 | 文本处理 | - | - | 数据验证与标准化 |
| 2. 剧本 | LLM | 千问/Qwen/DeepSeek | Llama/Local | 故事生成与剧本创作 |
| 3. 画面描述 | LLM + Prompt工程 | 同上 | 同上 | 提示词优化与构建 |
| 4. 图像 | 文生图模型 | 通义万相/Flux/SD | SDXL/SD3 | 角色与场景生成 |
| 5. 分镜 | 算法编排 | - | - | 时间轴与镜头规划 |
| 6. 动画 | 视频处理 | - | FFmpeg/OpenCV | 运镜与帧序列 |
| 7. 音频 | TTS/音效/音乐 | Azure/Fish/Suno | VITS/GPT-SoVITS | 音频轨道生成 |
| 8. 字幕 | 文字渲染 | - | Pillow/Cairo | 对话气泡与字幕 |
| 9. 合成 | 视频编码 | - | FFmpeg/MoviePy | 多轨道合成渲染 |
| 10. 输出 | 文件处理 | - | - | 格式化与交付 |


## 数据流示意图

```
用户输入
   │
   ▼
┌─────────┐
│ 输入数据 │
└────┬────┘
     │
     ▼
┌─────────┐     ┌─────────┐     ┌─────────┐     ┌─────────┐
│ 剧本数据 │────▶│ 画面描述 │────▶│ 图像文件 │────▶│ 分镜数据 │
└────┬────┘     └────┬────┘     └────┬────┘     └────┬────┘
     │               │               │               │
     │               │               │               ▼
     │               │               │         ┌─────────┐     ┌─────────┐
     │               │               │         │ 动画帧  │────▶│ 音频轨道 │
     │               │               │         └────┬────┘     └────┬────┘
     │               │               │              │               │
     ▼               ▼               ▼               ▼               ▼
┌────────────────────────────────────────────────────────────────────────┐
│                            合成渲染                                        │
└────────────────────────────────────┬───────────────────────────────────┘
                                     │
                                     ▼
                              ┌──────────────┐
                              │  最终视频     │
                              └──────────────┘
```
