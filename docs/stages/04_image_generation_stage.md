# 阶段4：图像生成阶段详细说明

## 1. 概述

图像生成阶段负责将画面描述和提示词转换为实际的静态图像。本阶段使用文生图模型（如Stable Diffusion、Midjourney等）生成高质量的角色和场景图像，并进行后处理以确保角色一致性和画面质量。

---

## 2. 静态图像生成

### 2.1 文生图（Text-to-Image）

#### 模型选择

**主流文生图模型对比**：

| 模型 | 优点 | 缺点 | 适用场景 |
|-----|------|------|---------|
| Stable Diffusion XL | 开源、可控性强、可本地部署 | 需要较强硬件 | 通用推荐 |
| Stable Diffusion 3 | 最新、质量高、文字理解强 | 资源需求大 | 高质量输出 |
| Flux | 快速、质量好 | 闭源 | 快速生成 |
| Midjourney | 质量最高、艺术感强 | API受限、成本高 | 艺术风格 |
| DALL-E 3 | 文字理解最好 | 成本高、限制多 | 复杂描述 |

#### 生成流程


#### 批量生成策略

**候选图生成**：


### 2.2 角色一致性控制

#### LoRA应用

**LoRA加载与应用**：


**LoRA权重调优**：


#### ControlNet控制

**ControlNet类型与应用**：

| ControlNet类型 | 用途 | 权重建议 |
|---------------|------|---------|
| OpenPose | 控制角色姿态 | 0.8-1.0 |
| Depth | 控制深度/空间关系 | 0.5-0.8 |
| Canny | 控制线条/轮廓 | 0.3-0.6 |
| IP-Adapter | 保持角色特征 | 0.6-0.8 |

**多ControlNet组合**：


#### IP-Adapter应用

**IP-Adapter配置**：


**多参考图策略**：


#### Reference-only模式

**Reference实现**：


### 2.3 多视角生成

#### 视角规划

**视角序列规划**：


#### 连续动作生成

**动作序列生成**：


#### 表情变化序列

**表情序列生成**：


---

## 3. 图像后处理

### 3.1 画面增强

#### 超分辨率放大

**超分模型选择**：

| 模型 | 放大倍数 | 特点 | 速度 |
|-----|---------|------|------|
| Real-ESRGAN | 4x | 通用性好 | 快 |
| Real-ESRGAN Anime | 4x | 专门优化动漫 | 快 |
| SwinIR | 4x | 质量高 | 慢 |
| STLVFR | 2-4x | 细节丰富 | 中等 |

**超分处理流程**：


#### 降噪处理

**降噪策略**：


#### 锐化增强

**锐化处理**：


#### 色彩校正

**色彩调整**：


### 3.2 风格统一

#### 滤镜应用

**风格滤镜**：


#### 色调一致性

**色调映射**：


### 3.3 对话气泡预留处理

#### 空白区域检测

**检测算法**：


#### 预留框生成

**预留框可视化**：


---

## 4. 质量检查与选择

### 4.1 自动质量评分

#### 美学评分模型

**评分维度**：


#### 构图评估


### 4.2 图像筛选

#### 自动筛选流程


#### 人工确认模式


---

## 5. 输出与存储

### 5.1 图像输出格式

**输出配置**：


### 5.2 文件组织结构


---

## 6. 错误处理与重试

### 6.1 常见问题处理

**问题检测与解决方案**：

| 问题 | 检测方法 | 解决方案 |
|-----|---------|---------|
| 角色变形 | 检测身体比例异常 | 重新生成，增加负面提示词 |
| 颜色不一致 | 色彩统计对比 | 调整色彩参数 |
| 多余肢体 | 人体检测模型 | 重新生成，增加bad anatomy权重 |
| 质量低 | 分数低于阈值 | 调整采样参数重新生成 |
| 风格不符 | CLIP相似度检查 | 调整风格LoRA权重 |

### 6.2 自动重试机制


---

*文档版本：1.0*
*所属阶段：阶段4 - 图像生成*
*最后更新：2026-02-02*
