# FrameLeap 动态漫生成流程文档（文生图版）

## 1. 概述

本文档详细描述从**一句话/短文输入**到**最终动态漫输出**的完整全流程。整个流程中，所有视觉内容（场景、角色）均由AI模型生成，是一个端到端的自动化动态漫生成系统。

---

## 2. 完整生成流程

### 2.1 输入阶段

#### 2.1.1 用户输入
- **输入类型**
  - 一句话描述（如："一个少年在雨夜中遇到了神秘少女"）
  - 短篇小说/故事大纲（几百到几千字）
  - 剧本/脚本格式
  - 关键词标签（如：#冒险 #友情 #战斗）

- **附加输入（可选）**
  - 风格偏好（如：日式漫画、美式漫画、水墨风、赛博朋克等）
  - 角色设定描述
  - 参考风格图片
  - 目标时长/集数

#### 2.1.2 全局参数配置
- **生成参数**
  - 输出分辨率（1080p / 4K / 移动端优化）
  - 帧率（24/30/60 FPS）
  - 目标时长
  - 画面比例（16:9 / 9:16 / 4:3 / 21:9）

- **风格参数**
  - 艺术风格
  - 色彩基调
  - 渲染风格

---

### 2.2 剧本生成阶段

#### 2.2.1 故事分析与规划
- **输入理解**
  - 提取故事核心主题
  - 识别关键情节点
  - 分析故事结构（起承转合）

- **剧本结构规划**
  - 确定章节数量/分镜数量
  - 规划剧情节奏
  - 设计开场、高潮、结尾

#### 2.2.2 剧本/脚本生成
- **详细剧本生成**
  - 扩展故事内容为完整剧本
  - 生成场景描述
  - 创作角色台词
  - 添加旁白/独白

- **分镜脚本生成**
  - 将剧本拆分为具体镜头
  - 每个镜头的详细描述
  - 景别指定（远景、中景、近景、特写）
  - 运镜指令（推拉摇移）

- **台词与对白生成**
  - 角色对话内容
  - 情感标注（愤怒、悲伤、喜悦等）
  - 停顿/语速标注

#### 2.2.3 角色设定生成
- **角色档案创建**
  - 外貌描述（发型、服饰、体貌特征）
  - 性格特征
  - 表情设定库
  - 服装/造型变化

- **角色一致性确保**
  - 提取角色关键特征向量
  - 生成角色参考图（正面、侧面、背面）
  - 建立角色Embedding/LoRA

---

### 2.3 画面描述生成阶段

#### 2.3.1 场景描述生成
- **环境描述**
  - 场景类型（室内/室外/幻想世界等）
  - 时间/天气/光照条件
  - 背景细节描述
  - 氛围营造

- **光影叙事功能**
  | 光影类型 | 视觉效果 | 叙事功能 | 情感暗示 |
  |---------|---------|---------|---------|
  | 顺光 | 明亮、清晰 | 展示细节 | 开放、坦诚 |
  | 侧光 | 立体、层次 | 塑造型体 | 神秘、深度 |
  | 逆光 | 剪影、轮廓 | 象征、对抗 | 冲突、未知 |
  | 顶光 | 阴影向下 | 压抑、扭曲 | 负面、恐怖 |
  | 底光 | 阴影向上 | 怪诞、反常 | 邪恶、超自然 |
  | 轮廓光 | 边缘光晕 | 分离主体 | 神圣、重要 |

- **色彩心理学应用**
  | 色调 | 情感联想 | 适用场景 | 搭配建议 |
  |-----|---------|---------|---------|
  | 暖色调（红橙黄） | 热情、活力、温暖 | 爱情、冒险、喜剧 | 高饱和度表现活力 |
  | 冷色调（蓝青紫） | 冷静、忧郁、科技 | 悬疑、科幻、悲伤 | 低饱和度增强忧郁 |
  | 高对比度 | 冲突、激烈、戏剧化 | 对抗、高潮、惊悚 | 黑白、互补色 |
  | 低对比度 | 和谐、平淡、模糊 | 回忆、梦境、日常 | 同类色、邻近色 |
  | 单色调 | 强调、专注、象征主义 | 内心、抽象、艺术 | 配合构图强调 |

- **构图描述**
  - 画面布局
  - 视角选择
  - 焦点位置
  - 留白处理（对话气泡预留）

- **景别叙事功能**
  | 景别 | 叙事功能 | 情感传递 | 典型用法 |
  |-----|---------|---------|---------|
  | 大远景/远景 | 交代环境、定位时空 | 孤立、渺小、宏大 | 开场、转场、环境展示 |
  | 全景 | 展示人物全身、关系位置 | 客观、陈述 | 角色出场、动作展示 |
  | 中景 | 展现互动、日常对话 | 亲近、自然 | 最常用的叙事景别 |
  | 中近景 | 聚焦上半身、表情细节 | 关注、投入 | 对话、情感交流 |
  | 近景 | 强调面部、情绪表达 | 亲密、压迫 | 情感高潮、内心展现 |
  | 特写 | 突出细节、象征意义 | 紧张、重要 | 物品特写、情绪极值 |
  | 大特写 | 极致聚焦、抽象表达 | 不适、震撼 | 眼睛、伤口、符号 |

- **视觉心理学应用**
  - 黄金分割与视觉焦点
  - 视觉重量与画面平衡
  - 引导线与视线流动
  - 留白的呼吸感

#### 2.3.2 提示词（Prompt）工程
- **图像生成提示词构建**
  - 主体描述（角色、动作、表情）
  - 环境描述（场景、光照、氛围）
  - 风格修饰词（线稿风格、赛璐璐上色、水彩等）
  - 质量词（masterpiece、high quality、detailed等）
  - 负面提示词（nsfw、low quality、deformed等）

- **SD/MJ专用格式**
  - 权重标注（如：(red dress:1.2)）
  - 混合提示词（如：[boy|girl]）
  - 步数/采样器参数
  - CFG Scale设置

---

### 2.4 图像生成阶段

#### 2.4.1 静态图像生成
- **文生图（Text-to-Image）**
  - 使用Stable Diffusion / Midjourney / DALL-E等模型
  - 批量生成多张候选图
  - 图像质量筛选
  - 最佳图像选择（自动评分或人工确认）

- **角色一致性控制**
  - 使用LoRA/Embedding固定角色形象
  - 使用ControlNet控制姿态
  - 使用IP-Adapter保持角色特征
  - 使用Reference-only模式

- **多视角生成**
  - 同一角色多角度生成
  - 连续动作序列生成
  - 表情变化序列生成

#### 2.4.2 图像后处理
- **画面增强**
  - 超分辨率放大（ESRGAN/Real-ESRGAN）
  - 降噪处理
  - 锐化增强
  - 色彩校正

- **风格统一**
  - 应用统一滤镜
  - 调整色调一致性
  - 线稿强化（如需）

- **对话气泡预留处理**
  - 识别对话区域
  - 预留空白或半透明区域
  - 或后期添加对话气泡图层

---

### 2.5 分镜编排阶段

#### 2.5.1 镜头序列规划
- **时间轴编排**
  - 确定每个镜头的时长
  - 安排镜头顺序
  - 设计转场时机

- **镜头类型分配**
  - 建立镜头（远景交代环境）
  - 对话镜头（中近景）
  - 情绪特写（近景/特写）
  - 动作镜头（动态构图）

- **视觉叙事原则**
  - 180度轴线规则（保证空间方向感）
  - 30度原则（相邻镜头角度变化至少30度）
  - 镜头递进逻辑（由远到近/由近到远）
  - 视觉焦点引导（引导观众视线）

#### 2.5.2 节奏控制
- **整体节奏规划**
  - 快节奏段落的快速剪辑
  - 慢节奏段落的长时间停留
  - 高潮部分的镜头密度

- **节奏呼吸设计**
  - 张弛有度的镜头组合
  - 悬念点的视觉停留
  - 情感释放的镜头延展
  - 转场的节奏过渡

- **叙事节奏类型**
  | 节奏类型 | 镜头特征 | 适用场景 | 情感效果 |
  |---------|---------|---------|---------|
  | 紧凑型 | 短镜头、快切 | 冲突、追逐、危机 | 紧张、压迫 |
  | 舒缓型 | 长镜头、慢推 | 抒情、回忆、沉思 | 平和、深沉 |
  | 递进型 | 逐层推进 | 揭秘、展现、情绪积累 | 期待、震撼 |
  | 交错型 | 正反打、平行剪辑 | 对话、双线叙事 | 对比、呼应 |

---

### 2.6 动画化阶段

#### 2.6.1 运镜生成
- **虚拟摄像机运动**
  - 平移（Pan）：模拟横向移动
  - 缩放（Zoom）：推近/拉远效果
  - 旋转：缓慢旋转增加动态感
  - 复合运动：多种运镜组合

- **实现方式**
  - 图像裁剪+平移
  - 图像缩放
  - 仿射变换
  - 基于深度图的视差效果

#### 2.6.2 画面元素动画
- **角色动画**
  - 呼吸效果（微小缩放）
  - 头部微小摆动
  - 眼睛眨动
  - 发丝飘动
  - 衣服褶皱变化

- **实现方式**
  - 图像动画化模型（如AnimateDiff、LivePortrait）
  - 表情迁移
  - 关键点驱动动画
  - 光流法变形

#### 2.6.3 环境动画
- **背景动态**
  - 云层移动
  - 水面波动
  - 树叶摇曳
  - 光影变化

- **天气特效**
  - 雨雪粒子
  - 雾气扩散
  - 闪光/雷电
  - 烟雾/火焰

- **实现方式**
  - 粒子系统
  - 程序化生成
  - 视频素材叠加
  - AI特效生成

#### 2.6.4 特效动画
- **漫画特效**
  - 速度线（放射状/平行线）
  - 冲击波
  - 集中线（强调效果）
  - 拟声词动态效果

- **转场效果**
  - 淡入淡出
  - 擦除转场
  - 缩放转场
  - 漫画分镜格转场

---

### 2.7 音频生成阶段

#### 2.7.1 配音生成
- **语音合成（TTS）**
  - 文字转语音
  - 音色选择（不同角色不同声音）
  - 情感调节（喜怒哀乐）
  - 语速/停顿控制

- **角色音色一致性**
  - 为每个角色分配固定音色
  - 音色特征保存
  - 跨段落音色统一

- **音画配合艺术原则**
  | 配合类型 | 说明 | 应用场景 |
  |---------|------|---------|
  | 同步配合 | 声音与画面动作完全同步 | 台词、动作音效 |
  | 画外音 | 声音来自画面外 | 旁白、内心独白 |
  | 先声 | 声音先于画面出现 | 预示、悬念 |
  | 后声 | 声音延续到画面之后 | 情感延续、余韵 |
  | 对位配合 | 声画情绪对立反差 | 讽刺、冲突表达 |

#### 2.7.2 音效生成
- **环境音效**
  - 风声、雨声、城市噪音
  - 室内回声
  - 自然环境音

- **动作音效**
  - 脚步声、碰撞声
  - 武器声、魔法声
  - 开门/关门等日常音效

- **实现方式**
  - 音效库匹配
  - AI音效生成
  - 音频合成

#### 2.7.3 背景音乐
- **BGM生成/选择**
  - 根据场景氛围匹配音乐
  - 情感标签匹配（紧张、温馨、悲伤等）
  - 节奏与画面同步

- **实现方式**
  - 音乐生成模型（如Suno、Udio）
  - 音乐库匹配
  - 混合多段音乐

#### 2.7.4 音频混音
- **音轨平衡**
  - 对白音量
  - 音效音量
  - BGM音量
  - 动态范围控制

- **音频同步**
  - 与画面时间轴对齐
  - 口型同步调整
  - 音画同步校验

- **声音空间感设计**
  | 景别 | 声音处理 | 声音特性 | 说明 |
  |-----|---------|---------|------|
  | 大远景 | 强混响、低频弱 | 空旷、遥远 | 环境音为主 |
  | 中景 | 轻混响、平衡 | 自然、清晰 | 还原真实感 |
  | 近景 | 少混响、中频强 | 亲近、直接 | 强调细节 |
  | 特写 | 几乎无混响、全频强 | 紧迫、在场 | 身临其境 |

- **音乐剪辑点配合**
  - 音乐强拍与镜头切换配合
  - 音乐段落与场景段落对齐
  - 音乐高潮与剧情高潮同步
  - 音乐淡出与转场的衔接

---

### 2.8 文字与字幕阶段

#### 2.8.1 对话气泡生成
- **气泡样式**
  - 形状选择（圆形、圆角矩形、云形等）
  - 边框样式
  - 半透明效果
  - 尾巴指向

- **气泡排版**
  - 自动定位（避开重要画面元素）
  - 大小自适应
  - 多行排版
  - 阅读顺序（从右到左/从左到右）

#### 2.8.2 字幕生成
- **字幕内容**
  - 从剧本提取
  - 时间轴标注
  - 断句处理

- **字幕样式**
  - 字体选择
  - 大小/颜色
  - 描边/阴影
  - 位置（底部/顶部/跟随角色）

---

### 2.9 合成渲染阶段

#### 2.9.1 多轨道合成
- **视频轨道**
  - 主画面轨道
  - 特效图层轨道
  - 文字/字幕轨道

- **音频轨道**
  - 对白轨道
  - 音效轨道
  - BGM轨道

#### 2.9.2 最终渲染
- **编码输出**
  - 视频编码（H.264/H.265/VP9）
  - 音频编码（AAC/Opus）
  - 容器格式（MP4/WEBM/MOV）

- **质量控制**
  - 比特率设置
  - 色彩空间
  - 关键帧间隔

---

### 2.10 输出交付阶段

#### 2.10.1 文件输出
- **输出选项**
  - 完整视频文件
  - 分章节输出
  - 不同分辨率版本
  - 纯视频版/带字幕版

- **元数据添加**
  - 标题/作者信息
  - 章节标记
  - 封面缩略图

#### 2.10.2 预览与调整
- **实时预览**
  - 时间轴预览
  - 逐帧检查
  - 音画同步检查

- **修正机制**
  - 重新生成问题镜头
  - 调整音频平衡
  - 修改文字内容

---

## 3. 技术栈与模型

### 3.1 语言模型（LLM）
- **剧本生成**
  - GPT-4 / Claude / Gemini
  - 本地模型（Llama、Qwen、DeepSeek等）
  - 微调后的故事创作模型

- **功能**
  - 故事扩展
  - 剧本编写
  - 角色设计
  - 对白生成
  - 提示词生成

### 3.2 图像生成模型
- **文生图**
  - Stable Diffusion（SDXL、SD3、Flux）
  - Midjourney API
  - DALL-E 3

- **控制模型**
  - ControlNet（姿态控制、深度控制）
  - LoRA（风格/角色固定）
  - IP-Adapter（角色保持）
  - Reference-only

### 3.3 图像处理模型
- **超分辨率**
  - Real-ESRGAN
  - SwinIR
  - STLVFR

- **分割与深度**
  - SAM（Segment Anything）
  - MiDaS（深度估计）
  - RMBG-1.4（背景移除）

### 3.4 动画生成模型
- **图像动画化**
  - AnimateDiff
  - LivePortrait
  - DragGAN
  - Pika/Runway（视频生成）

- **帧插值**
  - RIFE
  - DAIN
  - FILM
  - CAIN

### 3.5 音频模型
- **语音合成**
  - Azure TTS
  - Google TTS
  - VITS
  - Coqui TTS
  - Fish Audio
  - GPT-SoVITS（克隆音色）

- **音效生成**
  - AudioLDM
  - Stable Audio
  - ElevenLabs

- **音乐生成**
  - Suno
  - Udio
  - MusicGen

### 3.6 传统技术
- **图像处理**
  - OpenCV（图像变换、光流）
  - FFmpeg（视频编解码）
  - PIL/Pillow（图像操作）

- **视频处理**
  - FFmpeg
  - MoviePy
  - OpenCV Video

---

## 4. 系统架构设计

### 4.1 模块划分
```
输入模块
    ↓
剧本生成模块（LLM）
    ↓
角色设计模块（LLM + 图像生成）
    ↓
分镜规划模块（LLM）
    ↓
提示词工程模块（LLM）
    ↓
图像生成模块（文生图模型）
    ↓
图像后处理模块（超分、增强）
    ↓
动画生成模块（动画化模型）
    ↓
音频生成模块（TTS + 音效 + 音乐）
    ↓
合成渲染模块（FFmpeg/视频引擎）
    ↓
输出模块
```

### 4.2 数据流
```
用户输入（文本）
    ↓
结构化剧本（JSON）
    ↓
角色配置 + 场景配置
    ↓
提示词序列
    ↓
图像序列（PNG/JPG）
    ↓
动画帧序列
    ↓
音频文件（WAV/MP3）
    ↓
合成时间轴
    ↓
最终视频（MP4/WEBM）
```

---

## 5. 用户交互流程

### 5.1 简单模式（一键生成）
```
1. 输入一句话/短文
2. 选择风格（可选）
3. 点击"生成"
4. 等待处理（显示进度）
5. 预览结果
6. 下载/分享
```

### 5.2 高级模式（分步控制）
```
1. 输入故事
2. 查看/编辑生成的剧本
3. 确认/调整角色设计
4. 调整分镜规划
5. 单张重新生成（如不满意）
6. 调整动画参数
7. 选择/调整音色
8. 最终渲染
9. 导出
```

### 5.3 专家模式（完全控制）
```
1. 输入/导入剧本
2. 手动指定镜头描述
3. 自定义提示词
4. 调整生成参数
5. 手动修图（可选）
6. 精细调整动画
7. 手动混音
8. 时间轴精确编辑
9. 高级编码设置
10. 批量导出
```

---

## 6. 质量控制与优化

### 6.1 一致性控制
- **角色一致性**
  - 固定角色Embedding/LoRA
  - 参考图对比检查
  - 自动相似度评分

- **风格一致性**
  - 统一Prompt模板
  - 风格LoRA
  - 后期滤镜统一

### 6.2 节奏优化
- **镜头时长**
  - 根据内容量自动调整
  - 对白镜头=阅读时长+缓冲
  - 动作镜头=动作完整展示时长

- **整体节奏**
  - 避免单调重复
  - 高潮适当延长
  - 转场自然

### 6.3 用户体验
- **进度可视化**
  - 总体进度条
  - 当前阶段提示
  - 预计剩余时间

- **交互友好**
  - 支持中途暂停/取消
  - 支持局部重新生成
  - 支持多版本对比

---

## 7. 性能与成本

### 7.1 计算资源
- **GPU需求**
  - 图像生成：需要8GB+ VRAM
  - 动画生成：需要12GB+ VRAM
  - 音频生成：CPU可运行

- **渲染时间估算**
  - 1分钟动态漫 ≈ 30-60分钟（取决于质量）
  - 可并行加速

### 7.2 API成本（如使用云端服务）
- **LLM API**：按token计费
- **图像生成API**：按张数计费
- **音频API**：按时长计费

---

## 8. 扩展功能（未来规划）

- **多角色音色自动分配**
- **自动唇语同步**
- **3D效果转换**
- **交互式剧情分支**
- **多语言自动翻译与配音**
- **漫画格布局自动生成**
- **批量剧集生产**
- **风格迁移（现有漫画→新风格）**
- **角色换装系统**
- **社区模板市场**

---

## 9. 子文档索引

详细的阶段说明文档已创建在 `docs/stages/` 目录下：

| 阶段 | 文档 | 描述 |
|-----|------|------|
| 阶段1 | [01_input_stage.md](stages/01_input_stage.md) | 输入阶段 - 用户输入接收与处理 |
| 阶段2 | [02_script_generation_stage.md](stages/02_script_generation_stage.md) | 剧本生成 - LLM驱动的故事创作 |
| 阶段3 | [03_scene_description_stage.md](stages/03_scene_description_stage.md) | 画面描述 - 提示词工程 |
| 阶段4 | [04_image_generation_stage.md](stages/04_image_generation_stage.md) | 图像生成 - 文生图与角色一致性 |
| 阶段5 | [05_storyboard_stage.md](stages/05_storyboard_stage.md) | 分镜编排 - 镜头序列与节奏控制 |
| 阶段6 | [06_animation_stage.md](stages/06_animation_stage.md) | 动画化 - 运镜与画面元素动画 |
| 阶段7 | [07_audio_generation_stage.md](stages/07_audio_generation_stage.md) | 音频生成 - 配音、音效与BGM |
| 阶段8 | [08_text_subtitle_stage.md](stages/08_text_subtitle_stage.md) | 文字字幕 - 对话气泡与字幕 |
| 阶段9 | [09_composition_rendering_stage.md](stages/09_composition_rendering_stage.md) | 合成渲染 - 多轨道合成与编码 |
| 阶段10 | [10_output_delivery_stage.md](stages/10_output_delivery_stage.md) | 输出交付 - 格式化与分发 |

## 10. 术语表

### 10.1 技术术语

| 术语 | 说明 |
|------|------|
| 文生图 | Text-to-Image，从文字描述生成图像 |
| 提示词 | Prompt，输入给AI模型的文字描述 |
| LoRA | Low-Rank Adaptation，用于微调模型的小型适配器 |
| Embedding | 文本/图像的向量表示，可用于固定角色/风格 |
| ControlNet | 控制生成图像的结构/姿态的模型 |
| IP-Adapter | 基于图像参考保持角色/风格一致性的技术 |
| 超分辨率 | 将低分辨率图像放大并增强细节 |
| 帧插值 | 在两帧之间生成过渡帧 |
| 运镜 | 模拟摄影机运动效果 |
| TTS | Text-to-Speech，文字转语音 |
| CFG Scale | Classifier Free Guidance Scale，控制生成与提示词的贴合程度 |

### 10.2 视觉叙事术语

| 术语 | 说明 |
|------|------|
| 180度轴线规则 | 两个角色互动时，摄像机只能在连线一侧180度范围内移动，保证空间方向一致 |
| 30度原则 | 相邻镜头的拍摄角度变化应至少30度，避免视觉跳跃 |
| 180度 shutter | 动作场景常用的快门角度，制造动作模糊感 |
| 视觉呼吸 | 镜头节奏的张弛变化，营造自然的观感 |
| 视觉重量 | 画面中各元素的视觉吸引力，影响构图平衡 |
| 黄金分割 | 将画面按1:1.618分割的构图法则 |
| 三分法 | 将画面分成九宫格，主体放在交叉点上 |
| 正负空间 | 主体（正空间）与留白（负空间）的平衡 |
| 视觉引导线 | 引导观众视线流动的线条元素 |
| 视觉节奏 | 画面元素重复、变化形成的韵律感 |
| 景别 | 画面取景范围，决定观众与画面的距离感 |
| 过肩镜头 | 越过一个角色的肩膀拍摄另一个角色，常用于对话 |
| 荷兰角 | 倾斜的构图，制造不安、紧张的氛围 |
| 视点镜头 | 模拟角色主观视角的拍摄方式 |
| 情绪特写 | 聚焦人物面部表情，传递情感信息 |
| 建立镜头 | 用远景交代场景环境、时空定位的镜头 |

### 10.3 剧作术语

| 术语 | 说明 |
|------|------|
| 三幕式结构 | 经典故事结构：铺垫（第一幕）、冲突（第二幕）、解决（第三幕） |
| 英雄之旅 | 约瑟夫·坎贝尔总结的普世故事模式 |
| 激励事件 | 打破主角日常平衡、引发故事的事件 |
| 情节点 | 推动剧情发展的关键事件 |
| 高潮 | 剧情冲突最激烈、情感最强烈的时刻 |
| 铺垫 | 为后续剧情做准备的情节 |
| 悬念 | 延迟满足、制造期待的手法 |
| 伏笔 | 提前暗示后续情节的细节 |
| 麦格芬 | 推动剧情发展但本身不重要的事物 |
| 角色弧光 | 角色在故事中的成长与变化 |

### 10.4 音频术语

| 术语 | 说明 |
|------|------|
| 画外音 | 画面外的人声或旁白 |
| 同期声 | 拍摄时录制的现场声音 |
| 拟音 | 后期制作的动作音效 |
| 混响 | 声音在空间中反射产生的效果 |
| 音画同步 | 声音与画面动作的精确配合 |
| 先声 | 声音先于画面出现，制造预示感 |
| 声音桥 | 声音延续到下一个场景，实现转场 |
| 声音空间感 | 通过混响、音量等营造的空间距离感 |
| 节奏点 | 音乐或音效的强拍位置 |
| 听觉焦点 | 听众注意力集中的声音元素 |

---

*文档版本：2.0（文生图全流程版）*
*创建日期：2026-02-02*
*最后更新：2026-02-02*
