# 阶段1：输入阶段详细说明

## 1. 概述

输入阶段是整个动态漫生成流程的起点，负责接收和处理用户的原始输入，并将其转换为系统可处理的标准化格式。

---

## 2. 用户输入类型详解

### 2.1 一句话描述

**定义**：用户用简短的一句话概括想要创作的动态漫内容。

**示例**：
- "一个少年在雨夜中遇到了神秘少女"
- "赛博朋克世界的侦探故事"
- "勇者战胜魔王后的归乡之路"

**处理方式**：
1. 提取核心关键词
2. 识别故事类型（冒险、恋爱、悬疑等）
3. 推断目标时长（短篇：1-3分钟，中篇：3-10分钟）
4. 补充隐含信息（时代背景、角色关系等）

**输入验证**：
- 最小长度：3个字
- 最大长度：200个字
- 必须包含至少一个名词（角色/场景）
- 建议包含动作或事件描述

### 2.2 短篇小说/故事大纲

**定义**：用户提供几百到几千字的完整故事描述。

**结构示例**：
```
第一章：相遇
（故事内容描述...）

第二章：冒险开始
（故事内容描述...）

第三章：最终决战
（故事内容描述...）
```

**处理方式**：
1. 章节识别与分割
2. 提取关键情节点
3. 识别出场角色
4. 场景切换点标记
5. 情感曲线分析

**输入格式**：
- 纯文本（.txt）
- Markdown（.md）
- JSON结构化格式

**建议长度**：
- 短篇：500-2000字（约3-5分钟动态漫）
- 中篇：2000-5000字（约5-15分钟动态漫）
- 长篇：5000字以上（分集处理）

### 2.3 剧本/脚本格式

**定义**：用户提供专业格式的剧本文件。

**标准格式**：
```
场景1：街道 - 夜晚

角色A：（惊讶）你是谁？
角色B：（微笑）我是来帮你的。

[动作描述：角色B伸出手，光芒闪烁]

旁白：在那个命运的夜晚，一切开始了。
```

**处理方式**：
1. 解析场景标记
2. 提取角色对话
3. 解析动作描述
4. 识别旁白/独白
5. 情感标注提取

**支持格式**：
- 标准剧本格式（.fountain）
- JSON剧本格式
- 自定义标记格式

### 2.4 关键词标签

**定义**：用标签形式描述动态漫的特征。

**示例**：
```
#冒险 #友情 #战斗 #魔法
#赛博朋克 #侦探 #悬疑
#校园 #恋爱 #日常
```

**处理方式**：
1. 标签分类（类型、风格、元素）
2. 标签权重计算
3. 自动补全缺失元素
4. 生成基础故事框架

**标签分类体系**：
- **类型标签**：冒险、恋爱、悬疑、恐怖、喜剧等
- **风格标签**：日漫、美漫、水墨、3D、像素风等
- **元素标签**：魔法、机甲、校园、职场、异世界等
- **情感标签**：温馨、热血、悲伤、治愈等

---

## 3. 附加输入选项

### 3.1 风格偏好

**风格类型**：

| 风格类别 | 选项 | 特征描述 |
|---------|------|---------|
| 艺术风格 | 日式漫画 | 线稿+赛璐璐上色，大眼小嘴比例 |
| | 美式漫画 | 粗线条，写实比例，阴影厚重 |
| | 韩漫风格 | 精致线稿，色彩华丽，网纸效果 |
| | 水彩风 | 水彩质感，边缘柔和，色彩通透 |
| | 油画风 | 厚重笔触，质感丰富，色彩浓郁 |
| | 像素风 | 8-bit/16-bit像素风格，复古感 |
| | 矢量扁平 | 扁平化设计，简洁明快 |
| 渲染风格 | 2D手绘 | 传统手绘质感 |
| | 2.5D轻立体 | 2D画面带立体感 |
| | 3D渲染 | 完全3D建模渲染 |
| | 混合风格 | 2D角色+3D背景 |

**风格参数**：
- 线条强度（0-100）
- 上色风格（赛璐璐/柔和/厚涂）
- 阴影强度（弱/中/强）
- 色彩饱和度（低/中/高）

### 3.2 角色设定描述

**单个角色设定模板**：
```
角色名称：主角A
性别：男
年龄：16岁
发型：黑色短发，略带凌乱
瞳色：琥珀色
身材：修长，略显单薄
服装：黑色立领校服，红色领结
性格：外表冷漠，内心善良
特征：左耳戴银色耳环
表情库：微笑、皱眉、惊讶、害羞
```

**批量导入格式（JSON）**：
```json
{
  "characters": [
    {
      "name": "主角A",
      "gender": "男",
      "age": 16,
      "appearance": {
        "hair": "黑色短发",
        "eyes": "琥珀色",
        "body": "修长",
        "outfit": "黑色立领校服"
      },
      "personality": "外表冷漠，内心善良",
      "features": ["左耳银色耳环"],
      "expression_set": ["微笑", "皱眉", "惊讶", "害羞"]
    }
  ]
}
```

### 3.3 参考风格图片

**图片类型**：
- 艺术风格参考图
- 角色设计参考图
- 场景氛围参考图
- 构图参考图

**上传限制**：
- 格式：JPG、PNG、WEBP
- 数量：单次最多10张
- 单张大小：不超过10MB
- 分辨率：建议不低于512x512

**图片用途**：
1. 提取风格特征（色彩、线条、质感）
2. 作为IP-Adapter的参考输入
3. 训练临时LoRA（如需完全复制风格）
4. 构图参考

### 3.4 目标时长/集数

**时长规格**：

| 类型 | 时长 | 适用场景 |
|-----|------|---------|
| 短片 | 30秒-2分钟 | 广告、短视频平台 |
| 普通篇 | 3-5分钟 | 单集故事、预告片 |
| 标准篇 | 5-15分钟 | 完整短故事 |
| 长篇 | 15分钟以上 | 多集连续剧 |

**集数规划**：
- 单集模式：生成一个完整视频
- 分集模式：长故事自动分割为多集
- 集数自动计算：根据内容量智能分配

---

## 4. 全局参数配置

### 4.1 生成参数

#### 输出分辨率

| 预设 | 分辨率 | 宽高比 | 适用场景 |
|-----|--------|-------|---------|
| 移动端竖屏 | 1080x1920 | 9:16 | 抖音、快手 |
| 移动端横屏 | 1920x1080 | 16:9 | YouTube、B站 |
| 高清 | 1920x1080 | 16:9 | 标准网络视频 |
| 超高清 | 3840x2160 | 16:9 | 4K平台 |
| 电影宽屏 | 2560x1080 | 21:9 | 电影感作品 |
| 正方形 | 1080x1080 | 1:1 | Instagram |
| 传统动画 | 1440x1080 | 4:3 | 传统动画风格 |

#### 帧率（FPS）

| 帧率 | 效果 | 适用场景 | 文件大小 |
|-----|------|---------|---------|
| 24 FPS | 电影感 | 电影风格作品 | 小 |
| 30 FPS | 标准 | 网络视频标准 | 中 |
| 60 FPS | 流畅 | 动作场景、高质量要求 | 大 |

**自动选择建议**：
- 对话为主：24 FPS
- 混合场景：30 FPS
- 动作场景：60 FPS

#### 画面比例

**宽高比选择**：
- 16:9 - 标准宽屏，最通用
- 9:16 - 移动端竖屏
- 4:3 - 传统动画/复古风格
- 21:9 - 电影宽屏
- 1:1 - 社交媒体

### 4.2 风格参数

#### 色彩基调

| 基调 | 描述 | 色彩特征 | 适用氛围 |
|-----|------|---------|---------|
| 明亮 | 高调照明 | 高亮度、低对比 | 日常、温馨、喜剧 |
| 正常 | 标准色彩 | 平衡的明暗对比 | 大多数场景 |
| 暗调 | 低调照明 | 低亮度、高对比 | 悬疑、恐怖、严肃 |
| 冷色 | 冷色调 | 蓝、绿、紫主导 | 科技、忧郁、冷静 |
| 暖色 | 暖色调 | 红、橙、黄主导 | 温馨、激情、复古 |
| 复古 | 复古色调 | 降低饱和度、偏黄/偏蓝 | 怀旧、回忆 |

#### 渲染风格

**渲染选项**：
- 线稿强度：0-100（0=无线稿，100=强线稿）
- 上色方式：赛璐璐 / 柔和 / 厚涂 / 水彩
- 阴影类型：无 / 简单 / 详细 / 卡通化
- 纹理添加：无 / 轻微 / 明显 / 强烈

---

## 5. 输入预处理

### 5.1 文本预处理

**处理步骤**：
1. **清洗**：去除特殊字符、多余空白
2. **标准化**：统一标点符号、数字格式
3. **分段**：智能分割段落、对话
4. **编码检测**：检测并转换文本编码（UTF-8）
5. **敏感词过滤**：检测并标记不当内容

### 5.2 输入验证

**验证规则**：
```
✓ 必填项检查
✓ 长度限制检查
✓ 格式正确性检查
✓ 字符编码检查
✓ 内容安全检查
```

**错误处理**：
- 缺失必填项 → 提示用户补充
- 超过长度限制 → 建议分段或精简
- 格式错误 → 显示错误位置并建议修正
- 编码问题 → 自动转换或提示用户
- 敏感内容 → 警告并询问是否继续

### 5.3 输入增强

**自动补充功能**：
- 根据标题自动生成建议描述
- 根据关键词扩展故事元素
- 根据角色名生成基础设定
- 根据场景词添加环境细节

---

## 6. 输入数据结构

### 6.1 内部数据格式

**标准输入对象（JSON示例）**：
```json
{
  "input_id": "req_20250202_001",
  "timestamp": "2025-02-02T10:30:00Z",
  "user_input": {
    "type": "text_description",
    "content": "一个少年在雨夜中遇到了神秘少女",
    "language": "zh-CN"
  },
  "parameters": {
    "resolution": {
      "width": 1920,
      "height": 1080,
      "aspect_ratio": "16:9"
    },
    "frame_rate": 30,
    "target_duration": 180,
    "quality": "high"
  },
  "style_preferences": {
    "art_style": "japanese_manga",
    "render_style": "2D_illustration",
    "color_tone": "cool",
    "line_strength": 70
  },
  "additional_inputs": {
    "reference_images": [],
    "character_settings": [],
    "music_preference": "auto"
  },
  "metadata": {
    "source": "web_ui",
    "user_id": "user_12345"
  }
}
```

### 6.2 数据传递

**传递流程**：
```
用户输入 → 验证 → 标准化 → 结构化 → 剧本生成模块
```

---

## 7. 用户界面设计建议

### 7.1 简单模式界面

```
┌─────────────────────────────────────────┐
│        FrameLeap 动态漫生成             │
├─────────────────────────────────────────┤
│                                         │
│  请输入你想创作的故事：                  │
│  ┌─────────────────────────────────┐   │
│  │ 一个少年在雨夜中遇到了神秘少女  │   │
│  └─────────────────────────────────┘   │
│                                         │
│  风格：[日式漫画 ▼]  时长：[自动 ▼]    │
│                                         │
│         [ 开始生成 ]                    │
│                                         │
└─────────────────────────────────────────┘
```

### 7.2 高级模式界面

```
┌─────────────────────────────────────────┐
│  输入 │ 故事 │ 角色 │ 分镜 │ 风格 │输出│
├─────────────────────────────────────────┤
│                                         │
│ 输入类型：○ 一句话  ○ 短文  ○ 剧本     │
│                                         │
│ 故事内容：                              │
│ ┌─────────────────────────────────┐   │
│ │                                  │   │
│ │                                  │   │
│ └─────────────────────────────────┘   │
│                                         │
│ 角色设定：[+ 添加角色]                  │
│   • 主角 - [编辑] [删除]                │
│                                         │
│ 参考图片：[+ 上传参考图]                │
│   • style_ref.jpg (预览)               │
│                                         │
│ 生成参数：                              │
│   分辨率：[1920x1080 ▼]                │
│   帧率：[30 FPS ▼]                     │
│   时长：[3-5分钟]                       │
│                                         │
│ 风格设置：                              │
│   艺术风格：[日式漫画 ▼]                │
│   色彩基调：[冷色调 ▼]                  │
│   线稿强度：━━━━○━━━ 70%               │
│                                         │
│         [ 下一步：生成剧本 ]            │
│                                         │
└─────────────────────────────────────────┘
```

---

## 8. 常见问题处理

### 8.1 输入过短

**问题**：用户输入太短，无法生成足够内容

**解决方案**：
1. 自动提示扩展选项
2. 提供示例供参考
3. 交互式引导补充信息
4. 基于输入自动生成扩展建议

### 8.2 输入过长

**问题**：输入内容过多，超出单次处理能力

**解决方案**：
1. 智能分段处理
2. 按章节/场景拆分
3. 建议用户分集生成
4. 提供内容摘要选项

### 8.3 模糊输入

**问题**：用户描述模糊，缺少关键信息

**解决方案**：
1. 识别模糊点并询问
2. 提供多项选择
3. 使用默认值并告知用户
4. 生成多个版本供选择

---

## 9. 质量保证

### 9.1 输入质量评分

**评分维度**：
- **完整性**：必填项是否齐全
- **清晰度**：描述是否明确
- **可行性**：是否能转换为视觉内容
- **创意性**：内容的原创程度

**评分等级**：
- 优秀（90-100分）：直接处理
- 良好（70-89分）：轻微补充后处理
- 一般（50-69分）：需要用户确认
- 较差（<50分）：建议修改

### 9.2 预处理检查清单

```
□ 文本编码正确（UTF-8）
□ 无非法字符
□ 长度在合理范围内
□ 必填字段完整
□ 参数值有效
□ 参考文件可访问
□ 内容符合规范
```

---

*文档版本：1.0*
*所属阶段：阶段1 - 输入*
*最后更新：2026-02-02*
